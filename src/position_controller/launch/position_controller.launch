<?xml version="1.0" encoding="UTF-8"?>
<launch>

  <!-- motion_mode: 0: turnwalkturn or 1: shuffle -->
  <arg name="motion_mode"                        default="0"/>
  <arg name="goal_distance_threshold"            default="0.1"/>
  <arg name="pose_input_topic"                   default="/state_estimator/pose_in_odom"/>
 <!-- <arg name="output_topic"                       default="/joy_manager/twist"/> -->
  <arg name="output_topic"                       default="/twist_mux/twist"/>
  <!-- The output type to publish twist messages as. Options are twist_stamped or twist -->
  <arg name="output_type"                        default="twist_stamped"/>
  <arg name="fixed_frame"                        default="odom"/>
  <arg name="goal_behind_mode"                   default="1"/>
  <!-- Only goals received in the given frames will be accepted  -->
  <arg name="valid_goal_frames"                  default="[map, odom]"/>

  <arg name="max_forward_linear_velocity"        default="0.15" />
  <arg name="max_lateral_linear_velocity"        default="0.05" />
  <arg name="max_angular_velocity"               default="0.2" />
  <arg name="max_turning_linear_velocity"        default="0.07" />
  <!-- If the control command is nonzero and less in absolute value than the
  minimum value, it will be set to the minimum value. -->
  <arg name="min_angular_velocity"               default="0"/>
  <arg name="min_linear_velocity"                default="0"/>
  <!-- If this value is non-zero, control commands will not exceed this rate.
  The rate of the control commands is defined by the rate at which messages
  are received on the pose input topic. -->
  <arg name="maximum_control_command_rate_hz"    default="10"/>
  <!-- If set, the controller will not publish twist values on the y axis.
  This is a naive method and simply sets y values computed by the controller
  to zero. -->
  <arg name="differential_drive"                 default="false"/>
  <!-- Set to true to make the robot consider the back of the robot as the front-->
  <arg name="back_is_front"                      default="false"/>
  <!-- If set to true, when the controller wants to turn only yaw velocities
  will be applied. The default is to apply both linear and angular velocities
  when turning. This is likely to improve performance on wheeled robots -->
  <arg name="yaw_exclusive_turns"                default="false"/>
  <!-- Ignore the heading of intermediate goals in a list passed to the position
  controller. When the robot reaches any goal in the list except the last it
  will not rotate. Does not affect single goals. -->
  <arg name="ignore_intermediate_goal_heading"   default="true"/>

  <!-- anymal position controller -->
  <!-- send footstep request to, compute the velocity to follow. execute it -->
  <node pkg="position_controller" type="position_controller_node" name="position_controller" output="screen" >
    <param name="pose_input_topic" value="$(arg pose_input_topic)" />
    <param name="output_topic" value="$(arg output_topic)"/>
    <param name="output_type" value="$(arg output_type)"/>
    <param name="maximum_control_command_rate_hz" value="$(arg maximum_control_command_rate_hz)"/>
    <param name="differential_drive"   value="$(arg differential_drive)"/>
    <param name="back_is_front" value="$(arg back_is_front)"/>
    <param name="yaw_exclusive_turns" value="$(arg yaw_exclusive_turns)"/>
    <param name="ignore_intermediate_goal_heading" value="$(arg ignore_intermediate_goal_heading)" />

    <param name="max_forward_linear_velocity" value="$(arg max_forward_linear_velocity)" />
    <param name="max_lateral_linear_velocity" value="$(arg max_lateral_linear_velocity)" />
    <param name="max_angular_velocity" value="$(arg max_angular_velocity)" />
    <param name="max_turning_linear_velocity" value="$(arg max_turning_linear_velocity)" />

    <param name="min_angular_velocity" value="$(arg min_angular_velocity)"/>
    <param name="min_linear_velocity" value="$(arg min_linear_velocity)"/>
    <param name="angular_gain_p" value="0.5" />
    <param name="fixed_frame" value="$(arg fixed_frame)"/>

    <rosparam param="valid_goal_frames" subst_value="True">$(arg valid_goal_frames)</rosparam>

    <!-- How close to approach goal before moving to the next one -->
    <param name="goal_distance_threshold" value="$(arg goal_distance_threshold)" />
    <param name="goal_heading_threshold" value ="0.1" />
    <param name="turn_to_face_heading_threshold" value ="0.2" />

    <!-- How to deal with goals behind the robot: 
    0 ignore: just ignore the request, drop the goal
    1 backwards: walk (blindly) backwards to the goal. practical in the lab.
    2 turnaround: turn around full and walk to it forwards. safer for missions.
    -->
    <param name="goal_behind_mode" value ="$(arg goal_behind_mode)" />

    <!-- gain for drawing robot back to trackline. -->
    <!-- set to zero to disable -->
    <param name="trackline_gain_p" value="0.5" />

    <param name="motion_mode" value="$(arg motion_mode)" />
  </node>

</launch>
